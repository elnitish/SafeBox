<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafeBox — Upload Success</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --bg:#070a13; --panel: rgba(255,255,255,0.06); --panel-strong: rgba(255,255,255,0.12); --text:#e6eaf3; --muted:#a6b0c3; --primary:#6aa9ff; --primary-strong:#4d8dff; --accent:#7cf5c2; --success:#10b981; --warning:#ffb86b; --error:#ff6b6b; --ring: rgba(108,170,255,.35); --glow: 0 10px 30px rgba(106,169,255,.25);} 
        *{box-sizing:border-box} html,body{height:100%}
        body{margin:0;font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);background:radial-gradient(1200px 800px at 10% -10%, rgba(77,141,255,.15), transparent 60%),radial-gradient(900px 600px at 100% 0%, rgba(124,245,194,.12), transparent 60%),var(--bg)}
        .container{max-width:1200px;margin:0 auto;padding:32px 16px 44px}
        /* Top bar */
        .topbar{display:flex;justify-content:space-between;align-items:center;gap:16px;padding:14px 16px;border-radius:16px;background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));border:1px solid rgba(255,255,255,.14);box-shadow:var(--glow)}
        .brand{display:flex;align-items:center;gap:10px;font-weight:800}
        .brand-mark{display:grid;place-items:center;width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg,var(--primary-strong),#2a6bff);color:#fff}
        .badges{display:flex;gap:8px;flex-wrap:wrap}
        .badge{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);color:var(--muted);font-weight:600;font-size:12px}
        /* Hero */
        .hero{margin-top:18px;border-radius:22px;padding:28px;background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));border:1px solid rgba(255,255,255,.14)}
        .hero-grid{display:grid;gap:28px;grid-template-columns:1.1fr .9fr;align-items:center}
        @media (max-width: 1000px){.hero-grid{grid-template-columns:1fr}}
        .title{font-size:clamp(28px,3vw,40px);margin:0 0 8px}
        .lead{margin:0;color:var(--muted)}
        .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:14px}
        .chip{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);font-size:12px;color:var(--text)}
        .metric{background:var(--panel);border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:16px}
        .metric h4{margin:0 0 6px;font-size:12px;letter-spacing:.08em;text-transform:uppercase;color:var(--muted)}
        .metric .val{display:flex;flex-direction:column;gap:2px}
        .metric .val strong{font-size:20px}
        .metric .val span{color:var(--muted);font-size:13px}
        /* Details */
        .grid{display:grid;gap:16px;margin-top:18px;grid-template-columns:repeat(3,1fr)}
        @media (max-width:1100px){.grid{grid-template-columns:repeat(2,1fr)}}
        @media (max-width:700px){.grid{grid-template-columns:1fr}}
        .card{border-radius:16px;padding:18px;background:var(--panel);border:1px solid rgba(255,255,255,.12)}
        .card h3{margin:0 0 10px;display:flex;gap:8px;align-items:center}
        .info{display:grid;gap:8px}
        .row{display:flex;align-items:center;gap:10px;color:var(--muted)}
        code{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);padding:4px 6px;border-radius:8px}
        .banner{display:flex;align-items:center;gap:8px;margin-top:8px;padding:10px;border-radius:12px;background:rgba(16,185,129,.12);color:#34d399;border:1px solid rgba(16,185,129,.25)}
        /* Network */
        .network{display:grid;gap:16px;grid-template-columns:1fr 1.2fr;align-items:stretch;margin-top:16px}
        @media (max-width:1000px){.network{grid-template-columns:1fr}}
        .panel{border-radius:20px;padding:22px;background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));border:1px solid rgba(255,255,255,.14)}
        .n-head{display:flex;align-items:center;gap:12px;margin-bottom:12px}
        .n-icon{width:48px;height:48px;border-radius:14px;display:grid;place-items:center;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);color:var(--accent)}
        .n-title{display:flex;flex-direction:column;gap:2px}
        .n-title small{color:var(--muted)}
        .n-grid{display:grid;gap:10px}
        .n-row{display:flex;justify-content:space-between;align-items:center;gap:12px}
        .n-row label{color:var(--muted)}
        .steps{display:grid;gap:12px;grid-template-columns:repeat(4,1fr)}
        @media (max-width:1000px){.steps{grid-template-columns:repeat(2,1fr)}}
        @media (max-width:700px){.steps{grid-template-columns:1fr}}
        .step{border-radius:16px;padding:14px;background:var(--panel);border:1px solid rgba(255,255,255,.12)}
        .num{width:30px;height:30px;border-radius:10px;display:grid;place-items:center;background:rgba(77,141,255,.18);color:var(--primary);font-weight:700}
        .actions{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin:18px 0}
        .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;font-weight:600;color:var(--text);background:var(--panel);border:1px solid rgba(255,255,255,.12);transition:transform .15s ease, box-shadow .2s ease}
        .btn:hover{transform:translateY(-1px);box-shadow:var(--glow)}
        .btn-primary{background:linear-gradient(135deg,var(--primary),var(--primary-strong));border-color:transparent}
        /* Toast */
        .toast{position:fixed;bottom:20px;right:20px;display:none;align-items:center;gap:10px;max-width:360px;padding:14px;border-radius:14px;background:var(--panel);border:1px solid rgba(255,255,255,.12);box-shadow:var(--glow)}
        .toast-icon{width:38px;height:38px;border-radius:12px;display:grid;place-items:center;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12)}
        /* Motion */
        .reveal{opacity:0;transform:translateY(8px);animation:reveal .5s ease forwards}
        .delay-1{animation-delay:.08s}.delay-2{animation-delay:.16s}.delay-3{animation-delay:.24s}.delay-4{animation-delay:.32s}
        @keyframes reveal{to{opacity:1;transform:none}}
    </style>
</head>

<body>
    <div class="container">
        <header class="topbar reveal">
            <div class="brand"><span class="brand-mark"><i class="fa-solid fa-vault"></i></span><span>SafeBox</span></div>
            <div class="badges">
                <span class="badge"><i class="fas fa-shield-alt"></i> Zero-Trust Arch</span>
                <span class="badge"><i class="fas fa-network-wired"></i> IPFS Network</span>
                <span class="badge"><i class="fas fa-cube"></i> Ethereum Ledger</span>
            </div>
        </header>

        <section class="hero reveal delay-1">
            <div class="hero-grid">
                <div>
                    <h1 class="title">Upload secured and anchored on‑chain</h1>
                    <p class="lead">Your file is encrypted, distributed via IPFS, and its integrity notarized on the blockchain. Review your proof below and keep your references safe.</p>
                    <div class="chips">
                        <span class="chip"><i class="fas fa-lock"></i> Encrypted at source</span>
                        <span class="chip"><i class="fas fa-check-circle"></i> Hash recorded</span>
                        <span class="chip"><i class="fas fa-globe"></i> Distributed storage</span>
                        <span class="chip"><i class="fas fa-cube"></i> On‑chain proof</span>
                    </div>
                </div>
                <div class="grid" style="grid-template-columns:1fr;gap:12px">
                    <div class="metric"><h4>File fingerprint</h4><div class="val"><strong id="metricFileName"><%= fileName %></strong><span id="metricFileSize"><%= fileSize %></span></div></div>
                    <div class="metric"><h4>Upload moment</h4><div class="val"><strong id="metricUploadTime"><%= uploadTime %></strong><span>Confirmation pending...</span></div></div>
                </div>
            </div>
        </section>

        <section class="grid">
            <article class="card reveal delay-1">
                <h3><i class="fas fa-file-code" style="color:var(--accent)"></i> File identity</h3>
                <div class="info">
                    <div class="row"><i class="fas fa-file"></i> <span id="fileName"><%= fileName %></span></div>
                    <div class="row"><i class="fas fa-weight-hanging"></i> <span id="fileSize"><%= fileSize %></span></div>
                    <div class="row"><i class="fas fa-clock"></i> <span id="uploadTime"><%= uploadTime %></span></div>
                    <div class="row"><i class="fas fa-hashtag"></i> <code id="ipfsHash"><%= ipfsHash %></code></div>
                </div>
                <div class="banner"><i class="fas fa-check"></i> Hash verified locally</div>
            </article>
            <article class="card reveal delay-2">
                <h3><i class="fas fa-cube" style="color:var(--accent)"></i> Blockchain receipt</h3>
                <div class="info">
                    <div class="row"><i class="fas fa-hashtag"></i> <code id="txHash">— pending —</code></div>
                    <div class="row"><i class="fas fa-cube"></i> <span id="blockNumber">Awaiting block...</span></div>
                    <div class="row"><i class="fas fa-gas-pump"></i> <span id="gasUsed">—</span></div>
                    <div class="row"><i class="fas fa-network-wired"></i> <span id="networkName">Ethereum</span></div>
                </div>
                <div class="banner" id="chainStatus"><i class="fas fa-spinner fa-spin"></i> Securing on‑chain</div>
            </article>
            <article class="card reveal delay-3">
                <h3><i class="fas fa-key" style="color:var(--accent)"></i> Access guidelines</h3>
                <div class="info">
                    <div class="row"><i class="fas fa-user-shield"></i> Keep your private key offline.</div>
                    <div class="row"><i class="fas fa-link"></i> Share the IPFS hash with trusted parties only.</div>
                    <div class="row"><i class="fas fa-database"></i> Retrieve via SafeBox dashboard or any IPFS gateway.</div>
                    <div class="row"><i class="fas fa-bolt"></i> On‑chain metadata is immutable for audit trails.</div>
                </div>
            </article>
        </section>

        <section class="network">
            <div class="panel reveal delay-2">
                <h2 style="margin:0 0 8px">Designed for verifiable trust</h2>
                <p style="margin:0;color:var(--muted)">End‑to‑end encryption, decentralized storage, and blockchain anchoring ensure confidentiality, durability, and provability.</p>
                <div style="display:grid;gap:12px;margin-top:12px">
                    <div class="row"><span class="n-icon"><i class="fas fa-lock"></i></span><div><strong>Zero‑knowledge encryption</strong><div class="row">Client‑side encryption keeps keys local.</div></div></div>
                    <div class="row"><span class="n-icon"><i class="fas fa-sitemap"></i></span><div><strong>IPFS content addressing</strong><div class="row">Immutable hashes route without central servers.</div></div></div>
                    <div class="row"><span class="n-icon"><i class="fas fa-fingerprint"></i></span><div><strong>Blockchain anchoring</strong><div class="row">On‑chain proof seals file authenticity.</div></div></div>
                </div>
            </div>
            <aside class="panel reveal delay-3">
                <div class="n-head"><div class="n-icon"><i class="fas fa-broadcast-tower"></i></div><div class="n-title"><small>Live transaction insights</small><strong>Immutable ledger confirmation</strong></div></div>
                <div class="n-grid">
                    <div class="n-row"><label>Status</label> <span id="txStatus">Submitting...</span></div>
                    <div class="n-row"><label>Confirmation ETA</label> <span>≈ 15s</span></div>
                    <div class="n-row"><label>Wallet</label> <span id="walletAddress">—</span></div>
                </div>
                <div class="steps" style="margin-top:12px">
                    <div class="step"><div class="num">01</div><strong>Encrypt</strong><div class="row">File secured locally.</div></div>
                    <div class="step"><div class="num">02</div><strong>Pin to IPFS</strong><div class="row">Chunks replicated.</div></div>
                    <div class="step"><div class="num">03</div><strong>Record on chain</strong><div class="row">CID stored on‑chain.</div></div>
                    <div class="step"><div class="num">04</div><strong>Verify proof</strong><div class="row">Integrity confirmed.</div></div>
                </div>
            </aside>
        </section>

        <div class="actions reveal delay-4">
            <a href="/home" class="btn btn-primary"><i class="fas fa-home"></i> Return to dashboard</a>
            <a href="/upload" class="btn"><i class="fas fa-upload"></i> Upload another file</a>
        </div>
    </div>

    <div class="toast" id="statusToast">
        <div class="toast-icon" id="toastIcon"><i class="fas fa-info"></i></div>
        <div>
            <div id="toastTitle" style="font-weight:600">Processing...</div>
            <div id="toastMessage" style="color:var(--muted)">Signing and broadcasting transaction.</div>
        </div>
    </div>

    <script>
        // Transaction data passed from server
        const txData = {
            txHash: `<%= txHash || '—' %>`,
            blockNumber: `<%= blockNumber || '—' %>`,
            gasUsed: `<%= gasUsed || '—' %>`,
            txStatus: `<%= txStatus || 'failed' %>`,
            networkName: `<%= networkName || 'Unknown' %>`,
            txError: `<%= txError || '' %>`,
            userAddress: `<%= userAddress || '—' %>`
        };

        // Display transaction results on page load
        window.addEventListener('DOMContentLoaded', () => {
            // Update blockchain receipt section
            document.getElementById('txHash').textContent = txData.txHash === 'null' || !txData.txHash ? '— pending —' : txData.txHash;
            document.getElementById('blockNumber').textContent = txData.blockNumber === 'null' || !txData.blockNumber ? 'Awaiting block...' : txData.blockNumber;
            document.getElementById('gasUsed').textContent = txData.gasUsed === 'null' || !txData.gasUsed ? '—' : `${txData.gasUsed} units`;
            document.getElementById('networkName').textContent = txData.networkName;
            document.getElementById('walletAddress').textContent = txData.userAddress !== 'null' && txData.userAddress ? txData.userAddress : '—';

            // Update status based on transaction result
            const chainStatusEl = document.getElementById('chainStatus');
            const txStatusEl = document.getElementById('txStatus');

            if (txData.txStatus === 'confirmed') {
                txStatusEl.textContent = 'Confirmed';
                chainStatusEl.innerHTML = '<i class="fas fa-check"></i> On-chain proof confirmed';
                chainStatusEl.style.background = 'rgba(16,185,129,0.12)';
                chainStatusEl.style.color = 'var(--success)';
            } else if (txData.txStatus === 'pending') {
                txStatusEl.textContent = 'Pending confirmation';
                chainStatusEl.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Awaiting confirmations';
            } else {
                txStatusEl.textContent = 'Failed';
                chainStatusEl.innerHTML = '<i class="fas fa-exclamation-triangle"></i> On-chain logging failed';
                chainStatusEl.style.background = 'rgba(239,68,68,0.12)';
                chainStatusEl.style.color = 'var(--error)';
                
                if (txData.txError && txData.txError !== 'null') {
                    console.error('Transaction error:', txData.txError);
                }
            }

            // Show toast notification
            const toast = {
                el: document.getElementById('statusToast'),
                icon: document.getElementById('toastIcon'),
                title: document.getElementById('toastTitle'),
                message: document.getElementById('toastMessage'),
                show(title, message, type = 'info') {
                    this.title.textContent = title;
                    this.message.textContent = message;
                    this.el.style.display = 'flex';
                    this.icon.innerHTML = type === 'success' ? '<i class="fas fa-check"></i>' : type === 'error' ? '<i class="fas fa-exclamation-triangle"></i>' : '<i class="fas fa-info"></i>';
                    this.icon.style.background = type === 'success' ? 'rgba(16,185,129,0.15)' : type === 'error' ? 'rgba(239,68,68,0.15)' : 'rgba(255,255,255,0.08)';
                    this.icon.style.color = type === 'success' ? '#34d399' : type === 'error' ? '#f87171' : '#6aa9ff';
                },
                hide(delay = 4500) { setTimeout(() => { this.el.style.display = 'none'; }, delay); }
            };

            if (txData.txStatus === 'confirmed') {
                toast.show('Success', 'File proof anchored on-chain successfully.', 'success');
            } else if (txData.txStatus === 'pending') {
                toast.show('Processing', 'Transaction is being confirmed on the blockchain...', 'info');
            } else {
                toast.show('Transaction failed', txData.txError || 'Could not record proof on-chain.', 'error');
            }
            toast.hide();
        });
    </script>
</body>

</html>

